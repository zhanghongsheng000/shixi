<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/animate.min.css" rel="stylesheet" />
		<link href="css/swiper.min.css" rel="stylesheet" />
		<style>
			ul,
			li,
			p {
				padding: 0;
				margin: 0;
				list-style: none;
			}
			
			sub {
				bottom: 0;
			}
			
			.banner {
				position: relative;
			}
			
			.banner>a {
				position: absolute;
				top: 5px;
				z-index: 2;
			}
			
			.banner>a img {
				width: 30px;
			}
			
			.left_user {
				left: 15px;
			}
			
			.right_emil {
				right: 15px;
			}
			
			.gongGao {
				padding: 5px 15px;
				background: #fff;
			}
			
			.gongGao p {
				display: inline-block;
				margin-bottom: 0;
				position: relative;
				top: -5px;
			}
			
			.content {
				margin-top: 10px;
				overflow: hidden;
			}
			
			.content ul li {
				width: 32%;
				background: #fff;
				float: left;
				margin-right: 2%;
				text-align: center;
				padding: 20px 0;
			}
			
			.content ul li img {
				width: 80%;
			}
			
			.content ul li p {
				margin-top: 5px;
				font-size: 15px;
			}
			
			.content ul li:last-child {
				margin-right: 0;
			}
			
			.new_project {
				overflow: hidden;
				margin-bottom: 10px;
			}
			
			.new_project>p.title {
				padding: 10px 15px;
				color: #000;
				font-size: 16px;
			}
			
			li.mui-table-view-cell label {
				font-size: 16px;
			}
			
			li.mui-table-view-cell span {
				color: #FF8553;
				font-size: 14px;
			}
			
			.mui-table-view-cell span {
				font-size: 15px;
			}
			
			.plan_jine {
				position: relative;
				padding: 10px 15px;
				background: #fff;
				overflow: hidden;
			}
			
			.plan_jine .plan_top {
				padding-right: 5px;
				margin-top: -11px;
				overflow: hidden;
			}
			
			.plan_top span {
				font-size: 16px;
			}
			
			.plan_jine .plan_top>span {
				position: relative;
				top: 10px;
			}
			
			.plan_jine .plan_top img {
				float: right;
				width: 30px;
			}
			
			.plan_jine ul {
				overflow: hidden;
				margin-top: 10px;
			}
			
			.plan_jine ul li {
				width: 33.3%;
				float: left;
				text-align: center;
			}
			
			.plan_jine ul li img {
				width: 46%;
			}
			
			.plan_jine ul li a {
				display: block;
				width: 50%;
				margin: 0 auto;
				font-size: 12px;
				text-align: center;
				background: #9FD8F9;
				color: #fff;
				border-radius: 10px;
			}
			
			.plan_jine ul li span {
				font-size: 2em;
				color: #FA6425;
				line-height: initial;
			}
			
			.plan_jine ul li sub {
				color: #FA6425;
			}
			
			.plan_jine ul li a.touZiZhong {
				background: #0AB7FF;
			}
			
			.plan_jine ul li a.touZiJieShu {
				background: #C0C0C0;
			}
			
			.look_more {
				color: #999999;
				padding: 10px 0;
				text-align: center;
				border-top: 1px solid #EAE8E6;
				border-bottom: 1px solid #EAE8E6;
				background: #FFF3EB;
				margin-bottom: 10px;
			}
			
			.t_num i {
				width: 10px;
				height: 12px;
				display: inline-block;
				background: url(css/number.png) no-repeat;
				background-position: 0 0;
				text-indent: -999em;
				background-size: 100%;
			}
			
			.swiper-container {
				width: 100%;
				height: 100%;
				top: -6px;
			}
			
			.swiper-slide {
				text-align: center;
				font-size: 18px;
				background: #fff;
				/* Center slide text vertically */
				display: -webkit-box;
				display: -ms-flexbox;
				display: -webkit-flex;
				display: flex;
				-webkit-box-pack: center;
				-ms-flex-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				-webkit-box-align: center;
				-ms-flex-align: center;
				-webkit-align-items: center;
				align-items: center;
			}
			
			.img-responsive {
				display: block;
				max-width: 100%;
				height: auto;
			}
			
			.swiper-pagination-bullet-active {
				background: #FC5C22
			}
			
			
			.swiper_wrap {
				display:inline-block;
				width:58%;
				height: 30px;
				margin: 0 auto;
				overflow: hidden;
			}
			
			.swiper_wrap ul {
				position: relative;
				top: 3px;
				left: 0;
				width: 100%;
				float: right;
				color: #444;
				font-size: 14px;
				margin-top: 1px;
			}
			
			.swiper_wrap ul li {
				width: 100%;
				overflow: hidden;
				text-overflow:ellipsis;
				white-space: nowrap;
				line-height: 30px;
			}
			.swiper_wrap ul li a{
				color:#333;
			}
		</style>
	</head>

	<body>
		<div class="banner">
			<a href="javascript:void(0)" class="left_user"  style="float: left;">
				<img src="img/user.png" alt="" />
			</a>
			<a href="javascript:void(0)" class="right_emil"  style="float: right;">
				<img src="img/emil.png" alt="" />
			</a>
			<!-- Swiper -->
			<div class="swiper-container">
				<div class="swiper-wrapper">

					<div class="swiper-slide"><img class="img-responsive" src="img/banner.jpg" /></div>
					<div class="swiper-slide"><img class="img-responsive" src="img/banner.jpg" /></div>
					<div class="swiper-slide"><img class="img-responsive" src="img/banner.jpg" /></div>
				</div>
				<!-- Add Pagination -->
				<div class="swiper-pagination"></div>
			</div>
		</div>
		<div class="gongGao">
			<img src="img/gongGao.png" alt="" style="width:10%;" />
			<p style="display:inline-block;width:88%;" >
				<span>最新公告：</span>
				<span style="display:inline-block;width:70%;position:relative;top:7px;overflow: hidden;text-overflow:ellipsis;white-space: nowrap;" class="FirstNewItem">-</span>
			</p>
		</div>
		<div class="content">
			<ul>
				<li>
					<img src="img/touZi.jpg" alt="" />
					<p class="t_num totle_touZi" number="0">0</p>
				</li>
				<li>
					<img src="img/huanKuan.jpg" />
					<p class="t_num totle_huanKuan" number="0">0</p>
				</li>
				<li>
					<img src="img/zhuanQu.jpg" alt="" />
					<p class="t_num totle_zhuanQu" number="0">0</p>
				</li>
			</ul>
		</div>
		<div class="project_list" id="BidList">
			<div class="new_project">
				<p class="title">最新项目</p>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" onclick="MuiUse.openWindow('xuequfangwu.html');">
						<label>学区房屋抵押贷款</label>
						<span>100元起投</span>
						<span>满标计息</span>
					</li>
				</ul>
				<div class="plan_jine">
					<div class="plan_top">
						<span>计划金额：<span>200,000</span>元</span>
						<img class="fang" src="img/fang.png" alt="" />
					</div>
					<div class="plab_box">
						<ul>
							<li style="margin-top: 1em;">
								<span>10</span><sub>%</sub>
								<p>年化收益率</p>
							</li>
							<li style="margin-top: 1em;">
								<span>30</span><sub>天</sub>
								<p>借款期限</p>
							</li>
							<li>
								<div class="percent_small_1" style="position:relative; ">
									<p style="position: absolute;top:17px;width: 100%; ">0%</p>
								</div>
								<a href="javascript:void(0) ">收益中</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<!--<div class="new_project ">
				<ul class="mui-table-view ">
					<li class="mui-table-view-cell ">
						<label>奔驰S60抵押贷款</label>
						<span>100元起投</span>
						<span>满标计息</span>
					</li>
				</ul>
				<div class="plan_jine ">
					<div class="plan_top ">
						<span>计划金额：<span>200,000</span>元</span>
						<img class="fang " src="img/che.png " alt=" " />
					</div>
					<div class="plab_box ">
						<ul>
							<li style="margin-top: 1em; ">
								<span>10</span><sub>%</sub>
								<p>年化收益率</p>
							</li>
							<li style="margin-top: 1em; ">
								<span>30</span><sub>天</sub>
								<p>借款期限</p>
							</li>
							<li>
								<div class="percent_small_1 " style="position:relative; ">
									<div style="position: absolute;top:17px;width: 100%; ">
										<font style="color: rgb(184,184,184); ">100%</font>
									</div>
								</div>
								<a class="touZiZhong " href="javascript:void(0) ">投资中</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			-->
		</div>
		<div class="look_more" style="display: none;">
			查看更多项目
		</div>
		<script src="js/mui.min.js "></script>
		<script src="js/jquery.js "></script>
		<script src="js/mui_use.js "></script>
		<script src="js/md5.js "></script>
		<script src="js/globals.js "></script>
		<script src="js/swiper.min.js "></script>
		<script src="js/animateBackground-plugin.js"></script>
		<script type="text/javascript" src="js/raphael.js"></script>
		<script type="text/javascript" src="js/BaseInfo.js"></script>
		<script type="text/javascript ">
			mui.init();
			var _self;
			var animateDiv
			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", function() {
					plusReady();
				}, false);
			}
			function plusReady() {
				_self = plus.webview.currentWebview(); //下拉刷新
				_self.setPullToRefresh({
					support: true,
					height: '50px',
					range: '100px',
					style: 'circle',
					offset: '1px'
				}, pulldownRefresh);
				Basics();
				Refresh();
				//				document.addEventListener("plusscrollbottom", onScrollToBottom, false); //上拉刷新
			}
			//基础配置
			function Basics() {

				//轮播图初始化
				var swiper = new Swiper('.swiper-container', {
					autoplay: 5000, //可选选项，自动滑动
					pagination: '.swiper-pagination',
					paginationClickable: true,
					observer: true, //修改swiper自己或子元素时，自动初始化swiper
					observeParents: true //修改swiper的父元素时，自动初始化swiper
				});
				//				animateDiv = $('.percent_small_1');
				//				animateEle();
				//查看更多项目
				$('.look_more').on('tap', function() {
					var Index_MainHTML;
					Index_MainHTML || (Index_MainHTML = plus.webview.getLaunchWebview());
					Index_MainHTML.evalJS("TapBottomBtn('BidList.html')");
				})
				//设置(已隐藏)
				$('.left_user').on('tap', function() {
					if(localStorage.getItem(global_localStorage.UserName) == null) {
						MuiUse.openWindow('login.html');
						return false;
					}
//					MuiUse.openWindow('setting.html');
					var Index_MainHTML;
					Index_MainHTML || (Index_MainHTML = plus.webview.getLaunchWebview());
					Index_MainHTML.evalJS("TapBottomBtn('UserIndex.html')");
				})
				//站内信(已隐藏)
				$('.right_emil').on('tap', function() {
					if(localStorage.getItem(global_localStorage.UserName) == null) {
						MuiUse.openWindow('login.html');
						return false;
					}
					MuiUse.openWindow('ShortMessage.html');
				})
			}
			//需要重新加载的
			function Refresh() {
				bannerList(); //轮播图
				NewsList() //最新公告
				platformInfo(); //获取平台信息
				bidList(); //获取投资列表

			}
			//轮播图
			function bannerList() {
				var success = function(response) {
					console.log('轮播图：' + JSON.stringify(response));
					$('.swiper-wrapper').empty();
					$('.swiper-pagination').empty();
					swiper = null;
					$('.swiper-wrapper').empty();
					for(var i = 0; i < response.list.length; i++) {
						var Item = response.list[i];
						var TempleteHtml = '<div class="swiper-slide"><img class="img-responsive" src="' + ImgUrl + Item.url + '" /></div>';
						$('.swiper-wrapper').append(TempleteHtml);
					}
				}

				var data = {}

				ajax(ApiUrl + global_ajaxObject.banners, data, success);
			}
			//最新公告
			function NewsList() {
				var success = function(response) {
					console.log('最新公告：' + JSON.stringify(response));
					
					for(var i = 0; i < response.list.length; i++) {
						var Item = response.list[i];
						$('.FirstNewItem').attr('data-id', Item.id);
						$('.FirstNewItem').html(Item.title);
					}

					if(response.totalPage == 0) {
						$('.FirstNewItem').html("暂无信息");
					}
					$('.FirstNewItem').off('tap');
					$('.FirstNewItem').on('tap', function() {
						if($(this).html() == "暂无信息") {
							return false;
						}
						localStorage.setItem(global_localStorage.NewsItemId, $(this).attr('data-id'));
						MuiUse.openWindow('NewsItem.html');
					})
				}
				var data = {
					pagesize: 1,
					page: 1,
					type: 16
				}
				ajax(ApiUrl + global_ajaxObject.newsList, data, success);
			}
			//获取平台信息
			function platformInfo() {
				var success = function(response) {
					console.log('获取平台信息：' + JSON.stringify(response));
					$('.totle_touZi').html(format_number(response.totalInvest));
					$('.totle_huanKuan').html(format_number(response.totalRepay));
					$('.totle_zhuanQu').html(format_number(response.userProfit));

				}

				var data = {}

				ajax(ApiUrl + global_ajaxObject.platformInfo, data, success);
			}
			//获取投资列表
			function bidList() {
				var success = function(response) {
					console.log('获取投资列表：' + JSON.stringify(response));
					$('#BidList').empty();
					for(var i = 0; i < response.list.length; i++) {
						var Item = response.list[i];
						var Itemid = Item.id; //投资项目id
						var Itemtitle = Item.title; //标题
						var ItemreleaseDate = Item.releaseDate; //发布时间
						var ItemleftTime = Item.leftTime; //剩余时间
						var Itemrate = Item.rate; //年化收益率
						var ItemdurationValue = Item.durationValue; //借款期限(数值)
						var ItemdurationUnit = Item.durationUnit; //借款期限(单位)
						var Itemprogress = Item.progress; //进度
						var Itemamount = Item.amount; //计划金额
						var ItemleftAmount = Item.leftAmount; //可投金额
						var ItemleftstartAmount = Item.startAmount; //起投金额
						var Itemlefttype = Item.type; //标的类型
						var ItemleftbidState = Item.bidState; //标的状态
						var TempleteHtml = '<div class="new_project animated bounceInRight BidItem" data-id="' + Itemid + '" style="-webkit-animation-delay: ' + (0.3 + 0.2 * i) + 's;">';
						if(i == 0) {
							TempleteHtml += '<p class="title">最新项目</p>';
						}
						TempleteHtml += '<ul class="mui-table-view">';
						TempleteHtml += '<li class="mui-table-view-cell">';
						TempleteHtml += '<label>' + Itemtitle + '</label>';
						TempleteHtml += '&nbsp;&nbsp;<span>' + ItemleftstartAmount + '元起投</span>';
						TempleteHtml += '&nbsp;&nbsp;<span>满标放款后次日计息</span></li></ul>';
						TempleteHtml += '<div class="plan_jine">';
						TempleteHtml += '<div class="plan_top">';
						TempleteHtml += '<span>计划金额：<span>' + format_number(Itemamount) + '</span>元</span>';
						TempleteHtml += '<img class="fang" src="' + GetBidTImgByBidType(Itemlefttype) + '" alt="" /></div>';
						TempleteHtml += '<div class="plab_box"><ul><li style="margin-top: 1em;">';
						TempleteHtml += '<span>' + Itemrate + '</span><sub>%</sub><p>年化收益率</p></li>';
						TempleteHtml += '<li style="margin-top: 1em;">';
						TempleteHtml += '<span>' + ItemdurationValue + '</span><sub>' + ItemdurationUnit + '</sub><p>借款期限</p></li>';
						TempleteHtml += '<li><div class="percent_small_1" style="position:relative; ">';
						TempleteHtml += '<p style="position: absolute;top:17px;width: 100%; ">' + Itemprogress + '%</p></div>';
						TempleteHtml += '<a href="javascript:void(0) ">' + ItemleftbidState + '</a>';
						TempleteHtml += '</li></ul></div></div></div>';
						$('#BidList').append(TempleteHtml);
					}
					$('.BidItem').off('tap');
					$('.BidItem').on('tap', function() {
						localStorage.setItem(global_localStorage.BidItemId, $(this).attr('data-id'));
						MuiUse.openWindow('BidItem.html');
					})
					$('.look_more').show();
					//进度条
					animateDiv = $('.percent_small_1');
					animateEle();
				}

				var data = {
					page: 1, //第几页
					pagesize: 3 //每页显示几条数据
				}

				ajax(ApiUrl + global_ajaxObject.investProjList, data, success);
			}
			//进度条
			function animateEle() { //百分比
				var playRange = {
					top: $(window).scrollTop(),
					bottom: $(window).scrollTop() + $(window).height()
				};
				//$(window).scroll(function() { animateEle() });
				animateDiv.each(function() {
					//if(playRange.top <= $(this).offset().top && playRange.bottom >= $(this).offset().top && !$(this).data('bPlay')) {
					$(this).data('bPlay', true);
					var nPercent = $(this).parent().find('p').text().replace(/\%/, '');
					//var nPercent = $(this).find('div').text().replace(/\%/, '');
					nPercent = Number(nPercent);
					$(this).svgCircle({
						parent: $(this)[0],
						w: 56,
						R: 26,
						sW: 3,
						color: ["#dc1e1e", "#dc1e1e", "#dc1e1e"],
						perent: [100, nPercent],
						speed: 150,
						delay: 400
					});
					//}
				});
			}
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					Refresh();
					_self.endPullToRefresh();
				}, 1500);
			}
			//标的类型
			function GetBidTImgByBidType(BidType) {
				var BidImgUrl = "img/fang.png";
				switch(BidType) {
					case '房屋抵押贷款':
						BidImgUrl = "img/fang.png";
						break;
					case '企业贷款':
						BidImgUrl = "img/qiYe.png";
						break;
					case '车辆抵押贷款':
						BidImgUrl = "img/che.png";
						break;
					case '金融资产抵押':
						BidImgUrl = "img/jin.png";
						break;
				}
				return BidImgUrl;
			}

			function format_number(n) {
				var b = parseInt(n).toString();
				var len = b.length;
				if(len <= 3) {
					return b;
				}
				var r = len % 3;
				return r > 0 ? b.slice(0, r) + "," + b.slice(r, len).match(/\d{3}/g).join(",") : b.slice(r, len).match(/\d{3}/g).join(",");
			}
		</script>
	</body>

</html>