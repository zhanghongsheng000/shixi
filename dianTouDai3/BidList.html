<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/animate.min.css" rel="stylesheet" />
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			ul,
			li,
			p {
				padding: 0;
				margin: 0;
				list-style: none;
			}
			
			sub {
				bottom: 0;
			}
			
			.mui-bar~.mui-content .mui-fullscreen {
				top: 44px;
				height: auto;
			}
			
			.mui-pull-top-tips {
				position: absolute;
				top: -20px;
				left: 50%;
				margin-left: -25px;
				width: 40px;
				height: 40px;
				border-radius: 100%;
				z-index: 1;
			}
			
			.mui-bar~.mui-pull-top-tips {
				top: 24px;
			}
			
			.mui-pull-top-wrapper {
				width: 42px;
				height: 42px;
				display: block;
				text-align: center;
				background-color: #efeff4;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
				box-shadow: 0 4px 10px #bbb;
				overflow: hidden;
			}
			
			.mui-pull-top-tips.mui-transitioning {
				-webkit-transition-duration: 200ms;
				transition-duration: 200ms;
			}
			
			.mui-pull-top-tips .mui-pull-loading {
				/*-webkit-backface-visibility: hidden;
				-webkit-transition-duration: 400ms;
				transition-duration: 400ms;*/
				margin: 0;
			}
			
			.mui-pull-top-wrapper .mui-icon,
			.mui-pull-top-wrapper .mui-spinner {
				margin-top: 7px;
			}
			
			.mui-pull-top-wrapper .mui-icon.mui-reverse {
				/*-webkit-transform: rotate(180deg) translateZ(0);*/
			}
			
			.mui-pull-bottom-tips {
				text-align: center;
				background-color: #efeff4;
				font-size: 15px;
				line-height: 40px;
				color: #777;
			}
			
			.mui-pull-top-canvas {
				overflow: hidden;
				background-color: #fafafa;
				border-radius: 40px;
				box-shadow: 0 4px 10px #bbb;
				width: 40px;
				height: 40px;
				margin: 0 auto;
			}
			
			.mui-pull-top-canvas canvas {
				width: 40px;
			}
			
			.mui-slider-indicator.mui-segmented-control {
				background-color: #efeff4;
			}
			
			.mui-segmented-control.mui-scroll-wrapper .mui-scroll {
				width: 100%;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item {
				width: 50%;
			}
			
			.mui-segmented-control.mui-scroll-wrapper {
				height: 40px;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				color: #000000;
				border-bottom: 0px solid #FD6B37!important;
			}
			
			.mui-pull-left {
				color: #000000
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.on {
				color: #FD6B37!important;
				border-bottom: 2px solid #FD6B37!important;
			}
			
			.new_project {
				overflow: hidden;
				margin-bottom: 10px;
			}
			
			.new_project>p.title {
				padding: 10px 15px;
				color: #000;
				font-size: 16px;
			}
			
			li.mui-table-view-cell label {
				font-size: 16px;
			}
			
			li.mui-table-view-cell span {
				color: #FF8553;
				font-size: 14px;
			}
			
			.mui-table-view-cell span {
				font-size: 15px;
			}
			
			.plan_jine {
				position: relative;
				padding: 10px 15px;
				background: #fff;
				overflow: hidden;
			}
			
			.plan_jine .plan_top {
				padding-right: 5px;
				margin-top: -11px;
				overflow: hidden;
			}
			
			.plan_top span {
				font-size: 16px;
			}
			
			.plan_jine .plan_top>span {
				position: relative;
				top: 10px;
			}
			
			.plan_jine .plan_top img {
				float: right;
				width: 30px;
			}
			
			.plan_jine ul {
				overflow: hidden;
				margin-top: 10px;
			}
			
			.plan_jine ul li {
				width: 33.3%;
				float: left;
				text-align: center;
			}
			
			.plan_jine ul li img {
				width: 46%;
			}
			
			.plan_jine ul li a {
				display: block;
				width: 50%;
				margin: 0 auto;
				font-size: 12px;
				text-align: center;
				background: #9FD8F9;
				color: #fff;
				border-radius: 10px;
			}
			
			.plan_jine ul li span {
				font-size: 2em;
				color: #FA6425;
				line-height: initial;
			}
			
			.plan_jine ul li sub {
				color: #FA6425;
			}
			
			.plan_jine ul li a.touZiZhong {
				background: #0AB7FF;
			}
			
			.plan_jine ul li a.touZiJieShu {
				background: #C0C0C0;
			}
			
			.BidList {
				margin-top: 10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<!--<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>-->
			<h1 class="mui-title">投资列表</h1>
		</header>
		<div class="mui-content">

			<!--<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
				<div class="mui-scroll TopBtn" style="background-color: #FFFFFF;">
					<a class="mui-control-item mui-active on" href="#item1mobile" data-wid="BidListLeft.html">
						投资项目
					</a>
					<a class="mui-control-item" href="#item2mobile" data-wid="BidListLeft2.html">
						债权转让
					</a>
				</div>
			</div>-->

			<div class="BidList" id="BidList">
				<!--<div class="new_project ">
				<ul class="mui-table-view ">
					<li class="mui-table-view-cell ">
						<label>奔驰S60抵押贷款</label>
						<span>100元起投</span>
						<span>满标计息</span>
					</li>
				</ul>
				<div class="plan_jine ">
					<div class="plan_top ">
						<span>计划金额：<span>200,000</span>元</span>
						<img class="fang " src="img/che.png " alt=" " />
					</div>
					<div class="plab_box ">
						<ul>
							<li style="margin-top: 1em; ">
								<span>10</span><sub>%</sub>
								<p>年化收益率</p>
							</li>
							<li style="margin-top: 1em; ">
								<span>30</span><sub>天</sub>
								<p>借款期限</p>
							</li>
							<li>
								<div class="percent_small_1 " style="position:relative; ">
									<div style="position: absolute;top:17px;width: 100%; ">
										<p style="color: rgb(184,184,184); ">100%</p>
									</div>
								</div>
								<a class="touZiZhong " href="javascript:void(0) ">投资中</a>
							</li>
						</ul>
					</div>
				</div>
			</div>-->
			</div>
			<div class="BottomMsg" style="text-align: center;border-top: 0px solid #FA6425;height: 50px;line-height: 50px;">加载中...</div>
		</div>

		<script src="js/mui.min.js "></script>
		<script src="js/jquery.js "></script>
		<script src="js/mui_use.js "></script>
		<script src="js/md5.js "></script>
		<script src="js/globals.js "></script>
		<script src="js/swiper.min.js "></script>
		<script src="js/animateBackground-plugin.js"></script>
		<script type="text/javascript" src="js/raphael.js"></script>
		<script type="text/javascript" src="js/BaseInfo.js"></script>
		<script type="text/javascript">
			mui.init();
			var pageSize = 8;
			var page = 1;
			var totalPage = -1;
			var _self;
			var animateDiv
			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", function() {
					plusReady();
				}, false);
			}

			function plusReady() {
				_self = plus.webview.currentWebview(); //下拉刷新
				_self.setPullToRefresh({
					support: true,
					height: '50px',
					range: '100px',
					style: 'circle',
					offset: '1px'
				}, pulldownRefresh);
				Basics();
				Refresh();
				document.addEventListener("plusscrollbottom", onScrollToBottom, false); //上拉刷新
			}
			//基础配置
			function Basics() {

			}
			//需要重新加载的
			function Refresh() {
				bidList(); //获取投资列表
			}
			//重置数据
			function ResetData() {
				page = 1;
				totalPage = -1;
				$('.BottomMsg').show();
				$('.BottomMsg').html('加载中...');
				bidList();
			}
			//进度条
			function animateEle() { //百分比
				var playRange = {
					top: $(window).scrollTop(),
					bottom: $(window).scrollTop() + $(window).height()
				};
				//$(window).scroll(function() { animateEle() });
				animateDiv.each(function() {
					//if(playRange.top <= $(this).offset().top && playRange.bottom >= $(this).offset().top && !$(this).data('bPlay')) {
					$(this).data('bPlay', true);
					$(this).parent().find('svg').remove();
					var nPercent = $(this).parent().find('p').text().replace(/\%/, '');
					//var nPercent = $(this).find('div').text().replace(/\%/, '');
					nPercent = Number(nPercent);
					$(this).svgCircle({
						parent: $(this)[0],
						w: 56,
						R: 26,
						sW: 3,
						color: ["#dc1e1e", "#dc1e1e", "#dc1e1e"],
						perent: [100, nPercent],
						speed: 150,
						delay: 400
					});
					//}
				});
			}
			//获取投资列表

			function bidList() {
				if(totalPage == -1) {
					$('#BidList').empty();
				}
				var success = function(response) {
					console.log('获取投资列表1111：' + JSON.stringify(response));
					//$('.BottomMsg').hide();
					totalPage = response.totalPage;
					page++;
					for(var i = 0; i < response.list.length; i++) {
						var Item = response.list[i];
						var Item = response.list[i];
						var Itemid = Item.id; //投资项目id
						var Itemtitle = Item.title; //标题
						var ItemreleaseDate = Item.releaseDate; //发布时间
						var ItemleftTime = Item.leftTime; //剩余时间
						var Itemrate = Item.rate; //年化收益率
						var ItemdurationValue = Item.durationValue; //借款期限(数值)
						var ItemdurationUnit = Item.durationUnit; //借款期限(单位)
						var Itemprogress = Item.progress; //进度
						var Itemamount = Item.amount; //计划金额
						var ItemleftAmount = Item.leftAmount; //可投金额
						var ItemleftstartAmount = Item.startAmount; //起投金额
						var Itemlefttype = Item.type; //标的类型
						var ItemleftbidState = Item.bidState; //标的状态
						var TempleteHtml = '<div class="new_project animated bounceInRight BidItem" data-id="' + Itemid + '" style="-webkit-animation-delay: ' + (0.3 + 0.2 * i) + 's;">';
						TempleteHtml += '<ul class="mui-table-view">';
						TempleteHtml += '<li class="mui-table-view-cell">';
						TempleteHtml += '<label>' + Itemtitle + '</label>';
						TempleteHtml += '&nbsp;&nbsp;<span>' + ItemleftstartAmount + '元起投</span>';
						TempleteHtml += '&nbsp;&nbsp;<span>满标放款后次日计息</span></li></ul>';
						TempleteHtml += '<div class="plan_jine">';
						TempleteHtml += '<div class="plan_top">';
						TempleteHtml += '<span>计划金额：<span>' + format_number(Itemamount) + '</span>元</span>';
						TempleteHtml += '<img class="fang" src="' + GetBidTImgByBidType(Itemlefttype) + '" alt="" /></div>';
						TempleteHtml += '<div class="plab_box"><ul><li style="margin-top: 1em;">';
						TempleteHtml += '<span>' + Itemrate + '</span><sub>%</sub><p>年化收益率</p></li>';
						TempleteHtml += '<li style="margin-top: 1em;">';
						TempleteHtml += '<span>' + ItemdurationValue + '</span><sub>' + ItemdurationUnit + '</sub><p>借款期限</p></li>';
						TempleteHtml += '<li><div class="percent_small_1" style="position:relative; ">';
						TempleteHtml += '<p style="position: absolute;top:17px;width: 100%; ">' + Itemprogress + '%</p></div>';
						TempleteHtml += '<a href="javascript:void(0) ">' + ItemleftbidState + '</a>';
						TempleteHtml += '</li></ul></div></div></div>';
						$('#BidList').append(TempleteHtml);
					}
					$('.BidItem').off('tap');
					$('.BidItem').on('tap', function() {
						localStorage.setItem(global_localStorage.BidItemId, $(this).attr('data-id'));
						MuiUse.openWindow('BidItem.html');
					})
					if(page >= response.totalPage) {
						$('.BottomMsg').show();
						$('.BottomMsg').html(response.totalPage == 0 ? "暂无信息" : "没有更多数据了");
					}

					//进度条
					animateDiv = $('.percent_small_1');
					animateEle();
				}

				var data = {
					page: page, //第几页
					pagesize: pageSize //每页显示几条数据
				}

				ajax(ApiUrl + global_ajaxObject.investProjList, data, success);
			}
			// 处理滚动到窗口底部事件
			function onScrollToBottom() {

				$('.BottomMsg').show();
				if(totalPage < page && totalPage != -1) {
					$('.BottomMsg').html('没有更多数据了');
				} else {
					bidList();
				}
			}
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					ResetData();
					_self.endPullToRefresh();
				}, 1500);
			}
			//标的类型
			function GetBidTImgByBidType(BidType) {
				var BidImgUrl = "img/fang.png";
				switch(BidType) {
					case '房屋抵押贷款':
						BidImgUrl = "img/fang.png";
						break;
					case '企业贷款':
						BidImgUrl = "img/qiYe.png";
						break;
					case '车辆抵押贷款':
						BidImgUrl = "img/che.png";
						break;
					case '金融资产抵押':
						BidImgUrl = "img/jin.png";
						break;
				}
				return BidImgUrl;
			}

			function format_number(n) {
				var b = parseInt(n).toString();
				var len = b.length;
				if(len <= 3) {
					return b;
				}
				var r = len % 3;
				return r > 0 ? b.slice(0, r) + "," + b.slice(r, len).match(/\d{3}/g).join(",") : b.slice(r, len).match(/\d{3}/g).join(",");
			}
		</script>
	</body>

</html>